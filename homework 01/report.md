# Миниотчет: классификация по CAP

CAP применим только при наличии сетевого разделения (Partition). Ниже — поведение СУБД в условиях partition.


## Postgresql

У postgresql существуют различные способы репликации и поведение при P зависит от выбраного вида.

#### Shared Disk Failover
При выходе из строя любой ноды резервный сервер бд может быстро занять её место без потери данных и почти без потери доступности. Выглядит так, что здесь присутствуют и C, и A. Но в случае выхода из строя диска/дисковой системы мы теряем A и P.

#### SQL-Based Replication Middleware
Исхожу из того, что запросы на запись должны выполняться на всех узлах сразу, как указано в [документации](https://www.postgresql.org/docs/current/different-replication-solutions.html)
- С - должна гарантировать middleware-программа
- A - зависит от middleware-программы (предположительно должна блокироваться вся запись в кластер, может остаться только чтение)

#### Asynchronous Multimaster Replication
- C - отсутствует из-за асинхронной репликации (лаг записи на другую ноду)
- A - предоставляет

#### Synchronous Multimaster Replication
Не предоставляется из коробки в Postgreqsl и предлагается самостоятельно реализовывать на стороне клиента.

#### Asynchronous Master/Slave Replication
- C - отсутствует из-за асинхронной репликации (лаг записи на другую ноду)
- A - предоставляет, но с оговоркой, что если реплика была доступна только на чтение, то А только на чтение.

#### Synchronous Master/Slave Replication
- C - предоставляет
- A - предоставляет, но с оговоркой, что если реплика была доступна только на чтение, то А только на чтение.


### Apache Cassandra
В [документации](https://cassandra.apache.org/doc/latest/cassandra/architecture/guarantees.html) позиционируют себя как AT.
Но существует настройка tunable consistency, которая позволяет повысить согласованность, ожидая подтверждение от N реплик для записи.

### MongoDB
Позиционируют себя как CT в большинстве конфигураций(без кворума блокируется запись), но можно перейти к AT благодаря настройкам типа readPreference(позволяет читать с реплики) и writeConcern(сколько нужно подтверждений от нод для записи).
[Документация](https://www.mongodb.com/resources/basics/databases/cap-theorem)
